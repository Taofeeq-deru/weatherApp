<!DOCTYPE html>
<html>
  <head>
    <title>Weather App</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      /* #map {
        height: 100%;
      } */
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
        body {
            padding: 0;
            margin: 0;
            display: flex;
            flex-flow: column nowrap;
            /* justify-content: center; */
            align-items: center;
            background: #eeeeee;
            color: #555555;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        ul {
            list-style: none;
            display: flex;
            flex-flow: row wrap;
            /*justify-content: center;*/
            justify-content: center;
        }
        ul li {
            display: flex;
            flex-flow: column nowrap;
            margin: 1.5em;
            text-align: center;
            font-size: 1.2em;
            text-transform: capitalize;
        }

        i {
          font-style: italic;
          font-weight: bold;
        }

        #map {
          height: 60%;
          width: 100%;
          text-align: center;
        }
        
        @media screen and (min-width: 48em) {
          #map {
            max-width: 48em;
          }
        }

    </style>
  </head>
  <body>
    <h1>Weather App</h1>
    <div id="map"></div>
    <ul id="location"></ul>

    <script>

        function createNode(element) {
            return document.createElement(element); //create the type of element you pass in the parameters
        }

        function append(parent, el) {
          return parent.appendChild(el); //append the second parameter (element) to the first one (parent)
        }

        function id(idName) {
            return document.getElementById(idName); //get an element by it's id
        }

        function select(query) {
            return document.querySelector(query); //to select a query
        }

        function selectAll(queries) {
            return document.querySelectorAll(queries); //to select all queries
        }

        function log(codes) {
            return console.log(codes); //console log a code
        }

      const ul = select('#location');
      const map = id('map');

          let li = createNode('li'),
              weather = createNode('span'),
              city = createNode('span')

          function getLocation() {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(showPosition);
            } else {
              span.innerHTML = `<h1>Geolocation is not supported by this browser</h1>`
            }
          }

          function showPosition(position) {

            let lat = position.coords.latitude;
            let lng = position.coords.longitude;

            let mapURL = `https://maps.googleapis.com/maps/api/staticmap?center=${lat},${lng}&zoom=14&size=500x400&sensor=false&key=AIzaSyDDVxlDxBMFkM37SKcxczPnUUuSNr7qwp4`

            map.innerHTML = `<img src = ${mapURL}>`;

            fetch(`http://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&APPID=2c52f44abc37225f70c03a60124e1680`)
              .then((resp) => resp.json())
              .then(newData => {
                console.log(newData);

                weather.innerHTML = `Current weather: ${newData.weather[0].description}`

                
              })
              .catch(error => console.log('Weather Error'))

            fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=AIzaSyDDVxlDxBMFkM37SKcxczPnUUuSNr7qwp4`)
              .then((resp) => resp.json())
              .then( newData => {
                log(newData.results[0].formatted_address);

                city.innerHTML = `Location: ${newData.results[0].formatted_address}`
              })
              .catch(error => log("Address Error!!!"))

            append(li, city);
            append(li, weather);
            append(ul, li);

          }


        window.addEventListener('load', getLocation);
    </script>
  </body>
</html>